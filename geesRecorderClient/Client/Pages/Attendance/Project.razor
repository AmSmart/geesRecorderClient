@page "/attendance/project/{Id:int}"
@using Models = geesRecorderClient.Shared.Models;

@if (ProjectData is null)
{
    <Loading />
}
else
{
    if (ProjectData.Type == ProjectType.Attendance)
    {
        <MatButton OnClick="Enrol">Enrol</MatButton>

        <MatButton>Add Extra Fingerprint</MatButton>

        <MatButton>Mark Attendance</MatButton>

        <MatButton OnClick="(e => _dialogIsOpen = true)">New Event</MatButton>


        <MatDialog @bind-IsOpen="_dialogIsOpen">
            <MatDialogTitle>Add New Event</MatDialogTitle>
            <MatDialogContent>
<EditForm Model="AddNewEventDTO" OnValidSubmit="AddEvent">
   <p>Enter the Event details</p>
    <MatTextField @bind-Value="AddNewEventDTO.EventName" Label="Project Name"></MatTextField>
    <p>
            <MatDatePicker @bind-Value="AddNewEventDTO.Start"></MatDatePicker>
        </p>
        <p>
            <MatDatePicker @bind-Value="AddNewEventDTO.End"></MatDatePicker>
        </p>
    <MatButton type="submit">Add Event</MatButton>
</EditForm>

            </MatDialogContent>
            <MatDialogActions>
                <MatButton OnClick="@(e => { _dialogIsOpen = false; })">No Thanks</MatButton>
                <MatButton Type="submit" OnClick="AddEvent">OK</MatButton>
            </MatDialogActions>
        </MatDialog>
    }
    else if (ProjectData.Type == ProjectType.DataCollection)
    {

    }
}

@code{

    bool _dialogIsOpen = false;

    [Parameter]
    public int Id { get; set; }

    public Models.Project ProjectData { get; set; } = null;

    public AddNewEventDTO AddNewEventDTO { get; set; }

    [Inject]
    public NavigationManager NavigationManager { get; set; }

    [Inject]
    public ApiClient ApiClient { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var result = await ApiClient.GetProject(Id);
        if (result.Succeeded)
        {
            ProjectData = result.Data;
        }
        else
        {
            throw new Exception();
        }
    }

    public void Enrol()
    {
        Console.WriteLine("Enrol");
        NavigationManager.NavigateTo($"/attendance/enrol/{Id}");
    }

    public void AddEvent()
    {

    }
}